{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport viser from 'viser';\n\nfunction firstLowerCase(str) {\n  return str.replace(/^\\S/, function (s) {\n    return s.toLowerCase();\n  });\n}\n\nfunction retain(obj, attr) {\n  var newObj = Object.create(null);\n\n  for (var item in obj) {\n    if (obj.hasOwnProperty(item)) {\n      var arrAttr = Array.isArray(attr) ? attr : [attr];\n\n      if (arrAttr.indexOf(item) >= 0) {\n        newObj[item] = obj[item];\n      }\n    }\n  }\n\n  return newObj;\n}\n\nfunction omit(obj, attr) {\n  var newObj = Object.create(null);\n\n  for (var item in obj) {\n    if (obj.hasOwnProperty(item)) {\n      var arrAttr = Array.isArray(attr) ? attr : [attr];\n\n      if (arrAttr.indexOf(item) < 0) {\n        newObj[item] = obj[item];\n      }\n    }\n  }\n\n  return newObj;\n}\n\nfunction isOwnEmpty(obj) {\n  for (var name_1 in obj) {\n    if (obj.hasOwnProperty(name_1)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nvar Chart = function (_super) {\n  __extends(Chart, _super);\n\n  function Chart(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.config = {};\n    _this.views = {};\n    _this.facetviews = {};\n\n    _this.centralizedUpdates = function (unit) {\n      var config = _this.config;\n      var props = unit.props;\n      var displayName = unit.displayName;\n      var hasInViews = unit.context.hasInViews;\n\n      if (displayName === 'Facet') {\n        var options = omit(props, 'children');\n        config.facet = options;\n      } else if (displayName === 'FacetView') {\n        var viewId = unit.state.viewId;\n\n        if (!_this.facetviews[viewId]) {\n          _this.facetviews[viewId] = {\n            viewId: viewId\n          };\n        }\n\n        _this.combineViewConfig(props, _this.facetviews[viewId]);\n      } else if (displayName === 'View') {\n        var viewId = unit.state.viewId;\n\n        if (!_this.views[viewId]) {\n          _this.views[viewId] = {\n            viewId: viewId\n          };\n        }\n\n        _this.combineViewConfig(props, _this.views[viewId]);\n      } else {\n        if (!hasInViews) {\n          _this.combineContentConfig(displayName, props, config);\n        } else {\n          var viewType = unit.context.viewType;\n          var viewId = unit.context.viewId;\n\n          if (viewType === 'view') {\n            if (!_this.views[viewId]) {\n              _this.views[viewId] = {\n                viewId: viewId\n              };\n            }\n\n            _this.combineContentConfig(displayName, props, _this.views[viewId]);\n          } else if (viewType === 'facet') {\n            if (!_this.facetviews[viewId]) {\n              _this.facetviews[viewId] = {\n                viewId: viewId\n              };\n            }\n\n            _this.combineContentConfig(displayName, props, _this.facetviews[viewId]);\n          }\n        }\n      }\n    };\n\n    _this.portalRef = function (container) {\n      if (!_this.container) {\n        _this.container = container;\n      }\n    };\n\n    return _this;\n  }\n\n  Chart.prototype.getChildContext = function () {\n    return {\n      centralizedUpdates: this.centralizedUpdates,\n      hasInViews: false,\n      viewType: 'view'\n    };\n  };\n\n  Chart.prototype.combineChartConfig = function (props, config) {\n    var chartRetain = ['height', 'width', 'animate', 'forceFit', 'background', 'plotBackground', 'padding', 'theme', 'renderer', 'onMouseDown', 'onMouseMove', 'onMouseUp', 'onClick', 'onDbClick', 'onTouchStart', 'onTouchMove', 'onTouchEnd', 'onPlotEnter', 'onPlotMove', 'onPlotLeave', 'onPlotClick', 'onPlotDbClick'];\n    config.chart = retain(props, chartRetain);\n  };\n\n  Chart.prototype.combineViewConfig = function (props, config) {\n    if (props.data) {\n      config.data = props.data;\n    }\n\n    if (props.scale) {\n      config.scale = props.scale;\n    }\n\n    if (props.filter) {\n      config.filter = props.filter;\n    }\n\n    if (props.start) {\n      config.start = props.start;\n    }\n\n    if (props.end) {\n      config.end = props.end;\n    }\n  };\n\n  Chart.prototype.combineContentConfig = function (displayName, props, config) {\n    var realName = firstLowerCase(displayName);\n    var nameLowerCase = displayName.toLowerCase();\n    var regSeries = ['pie', 'sector', 'line', 'smoothLine', 'dashLine', 'stackLine', 'area', 'stackArea', 'smoothArea', 'bar', 'stackBar', 'dodgeBar', 'interval', 'stackInterval', 'dodgeInterval', 'point', 'waterfall', 'funnel', 'pyramid', 'radialBar', 'schema', 'box', 'candle', 'polygon', 'contour', 'heatmap', 'edge', 'sankey', 'jitterPoint', 'path', 'venn'];\n\n    if (regSeries.indexOf(realName) < 0 && isOwnEmpty(props)) {\n      config[nameLowerCase] = true;\n    } else if (regSeries.indexOf(realName) >= 0) {\n      if (!config.series) {\n        config.series = [];\n      }\n\n      config.series.push(__assign({\n        quickType: realName\n      }, props));\n    } else if (nameLowerCase === 'axis') {\n      if (!config.axis) {\n        config.axis = [];\n      }\n\n      config.axis.push(props);\n    } else if (nameLowerCase === 'series') {\n      if (!config.series) {\n        config.series = [];\n      }\n\n      config.series.push(props);\n    } else if (nameLowerCase === 'guide') {\n      if (!config.guide) {\n        config.guide = [];\n      }\n\n      config.guide.push(props);\n    } else if (nameLowerCase === 'legend') {\n      if (!config.legend) {\n        config.legend = [];\n      }\n\n      config.legend.push(props);\n    } else {\n      config[nameLowerCase] = props;\n    }\n\n    return config;\n  };\n\n  Chart.prototype.changeViewConfig = function () {\n    var views = this.views;\n    var facetviews = this.facetviews;\n    var config = this.config;\n\n    if (!isOwnEmpty(views)) {\n      config.views = [];\n\n      for (var item in views) {\n        if (views.hasOwnProperty(item)) {\n          config.views.push(views[item]);\n        }\n      }\n    }\n\n    if (!isOwnEmpty(facetviews)) {\n      config.facet.views = [];\n\n      for (var item in facetviews) {\n        if (facetviews.hasOwnProperty(item)) {\n          config.facet.views.push(facetviews[item]);\n        }\n      }\n    }\n  };\n\n  Chart.prototype.createChartInstance = function (config) {\n    if (this.chart) {\n      this.chart.destroy();\n    }\n\n    this.combineChartConfig(this.props, this.config);\n    this.combineViewConfig(this.props, this.config);\n    config.chart.container = this.container;\n    this.changeViewConfig();\n    this.chart = viser(config);\n  };\n\n  Chart.prototype.repaintChartInstance = function (config) {\n    this.combineChartConfig(this.props, this.config);\n    this.combineViewConfig(this.props, this.config);\n    this.changeViewConfig();\n\n    if (this.chart) {\n      this.chart.repaint(config);\n    } else {\n      config.chart.container = this.container;\n      this.chart = viser(config);\n    }\n  };\n\n  Chart.prototype.clearConfigData = function () {\n    this.config = {};\n    this.views = {};\n  };\n\n  Chart.prototype.componentDidMount = function () {\n    this.createChartInstance(this.config);\n    this.clearConfigData();\n  };\n\n  Chart.prototype.componentDidUpdate = function (props) {\n    this.repaintChartInstance(this.config);\n    this.clearConfigData();\n  };\n\n  Chart.prototype.componentWillUnmount = function () {\n    if (this.chart) {\n      this.chart.destroy();\n      this.chart = null;\n    }\n\n    this.container = null;\n  };\n\n  Chart.prototype.render = function () {\n    return React.createElement(\"div\", {\n      ref: this.portalRef\n    }, this.props.children);\n  };\n\n  Chart.childContextTypes = {\n    centralizedUpdates: PropTypes.func,\n    hasInViews: PropTypes.bool,\n    viewType: PropTypes.string\n  };\n  return Chart;\n}(React.Component);\n\nexport default Chart;","map":{"version":3,"sources":["../../src/components/Chart.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,KAAK,SAAZ,MAA2B,YAA3B;AACA,OAAO,KAAK,KAAZ,MAAuB,OAAvB;AACA,OAAO,KAAP,MAAkB,OAAlB;;AAGA,SAAS,cAAT,CAAwB,GAAxB,EAAmC;AACjC,SAAO,GAAG,CAAC,OAAJ,CAAY,KAAZ,EAAmB,UAAC,CAAD,EAAO;AAC/B,WAAO,CAAC,CAAC,WAAF,EAAP;AACD,GAFM,CAAP;AAGD;;AAED,SAAS,MAAT,CAAgB,GAAhB,EAA0B,IAA1B,EAAmC;AACjC,MAAM,MAAM,GAAG,MAAM,CAAC,MAAP,CAAc,IAAd,CAAf;;AAEA,OAAK,IAAM,IAAX,IAAmB,GAAnB,EAAwB;AACtB,QAAI,GAAG,CAAC,cAAJ,CAAmB,IAAnB,CAAJ,EAA8B;AAC5B,UAAM,OAAO,GAAG,KAAK,CAAC,OAAN,CAAc,IAAd,IAAsB,IAAtB,GAA6B,CAAC,IAAD,CAA7C;;AAEA,UAAI,OAAO,CAAC,OAAR,CAAgB,IAAhB,KAAyB,CAA7B,EAAgC;AAC9B,QAAA,MAAM,CAAC,IAAD,CAAN,GAAe,GAAG,CAAC,IAAD,CAAlB;AACD;AACF;AACF;;AAED,SAAO,MAAP;AACD;;AAED,SAAS,IAAT,CAAc,GAAd,EAAwB,IAAxB,EAAiC;AAC/B,MAAM,MAAM,GAAG,MAAM,CAAC,MAAP,CAAc,IAAd,CAAf;;AAEA,OAAK,IAAM,IAAX,IAAmB,GAAnB,EAAwB;AACtB,QAAI,GAAG,CAAC,cAAJ,CAAmB,IAAnB,CAAJ,EAA8B;AAC5B,UAAM,OAAO,GAAG,KAAK,CAAC,OAAN,CAAc,IAAd,IAAsB,IAAtB,GAA6B,CAAC,IAAD,CAA7C;;AAEA,UAAI,OAAO,CAAC,OAAR,CAAgB,IAAhB,IAAwB,CAA5B,EAA+B;AAC7B,QAAA,MAAM,CAAC,IAAD,CAAN,GAAe,GAAG,CAAC,IAAD,CAAlB;AACD;AACF;AACF;;AAED,SAAO,MAAP;AACD;;AAED,SAAS,UAAT,CAAoB,GAApB,EAA+B;AAC7B,OAAK,IAAM,MAAX,IAAmB,GAAnB,EAAwB;AACtB,QAAI,GAAG,CAAC,cAAJ,CAAmB,MAAnB,CAAJ,EAA8B;AAC5B,aAAO,KAAP;AACD;AACF;;AACD,SAAO,IAAP;AACD;;AAED,IAAA,KAAA,GAAA,UAAA,MAAA,EAAA;AAAmC,EAAA,SAAA,CAAA,KAAA,EAAA,MAAA,CAAA;;AAajC,WAAA,KAAA,CAAY,KAAZ,EAA0B;AAA1B,QAAA,KAAA,GACE,MAAA,CAAA,IAAA,CAAA,IAAA,EAAM,KAAN,KAAY,IADd;;AAJO,IAAA,KAAA,CAAA,MAAA,GAAc,EAAd;AACA,IAAA,KAAA,CAAA,KAAA,GAAa,EAAb;AACA,IAAA,KAAA,CAAA,UAAA,GAAkB,EAAlB;;AA+HA,IAAA,KAAA,CAAA,kBAAA,GAAqB,UAAC,IAAD,EAAU;AACpC,UAAM,MAAM,GAAG,KAAI,CAAC,MAApB;AACA,UAAM,KAAK,GAAG,IAAI,CAAC,KAAnB;AACA,UAAM,WAAW,GAAG,IAAI,CAAC,WAAzB;AACA,UAAM,UAAU,GAAG,IAAI,CAAC,OAAL,CAAa,UAAhC;;AAEA,UAAI,WAAW,KAAK,OAApB,EAA6B;AAC3B,YAAM,OAAO,GAAG,IAAI,CAAC,KAAD,EAAQ,UAAR,CAApB;AACA,QAAA,MAAM,CAAC,KAAP,GAAe,OAAf;AACD,OAHD,MAGO,IAAI,WAAW,KAAK,WAApB,EAAiC;AACtC,YAAM,MAAM,GAAG,IAAI,CAAC,KAAL,CAAW,MAA1B;;AACA,YAAI,CAAC,KAAI,CAAC,UAAL,CAAgB,MAAhB,CAAL,EAA8B;AAC5B,UAAA,KAAI,CAAC,UAAL,CAAgB,MAAhB,IAA0B;AAAE,YAAA,MAAM,EAAA;AAAR,WAA1B;AACD;;AACD,QAAA,KAAI,CAAC,iBAAL,CAAuB,KAAvB,EAA8B,KAAI,CAAC,UAAL,CAAgB,MAAhB,CAA9B;AACD,OANM,MAMA,IAAI,WAAW,KAAK,MAApB,EAA4B;AACjC,YAAM,MAAM,GAAG,IAAI,CAAC,KAAL,CAAW,MAA1B;;AACA,YAAI,CAAC,KAAI,CAAC,KAAL,CAAW,MAAX,CAAL,EAAyB;AACvB,UAAA,KAAI,CAAC,KAAL,CAAW,MAAX,IAAqB;AAAE,YAAA,MAAM,EAAA;AAAR,WAArB;AACD;;AACD,QAAA,KAAI,CAAC,iBAAL,CAAuB,KAAvB,EAA8B,KAAI,CAAC,KAAL,CAAW,MAAX,CAA9B;AACD,OANM,MAMA;AACL,YAAI,CAAC,UAAL,EAAiB;AACf,UAAA,KAAI,CAAC,oBAAL,CAA0B,WAA1B,EAAuC,KAAvC,EAA8C,MAA9C;AACD,SAFD,MAEO;AACL,cAAM,QAAQ,GAAG,IAAI,CAAC,OAAL,CAAa,QAA9B;AACA,cAAM,MAAM,GAAG,IAAI,CAAC,OAAL,CAAa,MAA5B;;AAEA,cAAI,QAAQ,KAAK,MAAjB,EAAyB;AACvB,gBAAI,CAAC,KAAI,CAAC,KAAL,CAAW,MAAX,CAAL,EAAyB;AACvB,cAAA,KAAI,CAAC,KAAL,CAAW,MAAX,IAAqB;AAAE,gBAAA,MAAM,EAAA;AAAR,eAArB;AACD;;AACD,YAAA,KAAI,CAAC,oBAAL,CAA0B,WAA1B,EAAuC,KAAvC,EAA8C,KAAI,CAAC,KAAL,CAAW,MAAX,CAA9C;AACD,WALD,MAKO,IAAI,QAAQ,KAAK,OAAjB,EAA0B;AAC/B,gBAAI,CAAC,KAAI,CAAC,UAAL,CAAgB,MAAhB,CAAL,EAA8B;AAC5B,cAAA,KAAI,CAAC,UAAL,CAAgB,MAAhB,IAA0B;AAAE,gBAAA,MAAM,EAAA;AAAR,eAA1B;AACD;;AACD,YAAA,KAAI,CAAC,oBAAL,CACE,WADF,EAEE,KAFF,EAGE,KAAI,CAAC,UAAL,CAAgB,MAAhB,CAHF;AAKD;AACF;AACF;AACF,KA7CM;;AA2HA,IAAA,KAAA,CAAA,SAAA,GAAY,UAAC,SAAD,EAAe;AAChC,UAAI,CAAC,KAAI,CAAC,SAAV,EAAqB;AACnB,QAAA,KAAI,CAAC,SAAL,GAAiB,SAAjB;AACD;AACF,KAJM;;;AAtPN;;AAEM,EAAA,KAAA,CAAA,SAAA,CAAA,eAAA,GAAP,YAAA;AACE,WAAO;AACL,MAAA,kBAAkB,EAAE,KAAK,kBADpB;AAEL,MAAA,UAAU,EAAE,KAFP;AAGL,MAAA,QAAQ,EAAE;AAHL,KAAP;AAKD,GANM;;AAQA,EAAA,KAAA,CAAA,SAAA,CAAA,kBAAA,GAAP,UAA0B,KAA1B,EAA0C,MAA1C,EAAqD;AACnD,QAAM,WAAW,GAAG,CAClB,QADkB,EACR,OADQ,EACC,SADD,EACY,UADZ,EAElB,YAFkB,EAEJ,gBAFI,EAEc,SAFd,EAEyB,OAFzB,EAGlB,UAHkB,EAIlB,aAJkB,EAIH,aAJG,EAIY,WAJZ,EAKlB,SALkB,EAKP,WALO,EAMlB,cANkB,EAMF,aANE,EAMa,YANb,EAOlB,aAPkB,EAOH,YAPG,EAOW,aAPX,EAQlB,aARkB,EAQH,eARG,CAApB;AAUA,IAAA,MAAM,CAAC,KAAP,GAAe,MAAM,CAAC,KAAD,EAAQ,WAAR,CAArB;AACD,GAZM;;AAcA,EAAA,KAAA,CAAA,SAAA,CAAA,iBAAA,GAAP,UAAyB,KAAzB,EAAyC,MAAzC,EAAoD;AAClD,QAAI,KAAK,CAAC,IAAV,EAAgB;AACd,MAAA,MAAM,CAAC,IAAP,GAAc,KAAK,CAAC,IAApB;AACD;;AAED,QAAI,KAAK,CAAC,KAAV,EAAiB;AACf,MAAA,MAAM,CAAC,KAAP,GAAe,KAAK,CAAC,KAArB;AACD;;AAED,QAAI,KAAK,CAAC,MAAV,EAAkB;AAChB,MAAA,MAAM,CAAC,MAAP,GAAgB,KAAK,CAAC,MAAtB;AACD;;AAED,QAAI,KAAK,CAAC,KAAV,EAAiB;AACf,MAAA,MAAM,CAAC,KAAP,GAAe,KAAK,CAAC,KAArB;AACD;;AAED,QAAI,KAAK,CAAC,GAAV,EAAe;AACb,MAAA,MAAM,CAAC,GAAP,GAAa,KAAK,CAAC,GAAnB;AACD;AAEF,GArBM;;AAuBA,EAAA,KAAA,CAAA,SAAA,CAAA,oBAAA,GAAP,UAA4B,WAA5B,EAAiD,KAAjD,EAAiE,MAAjE,EAA4E;AAC1E,QAAM,QAAQ,GAAG,cAAc,CAAC,WAAD,CAA/B;AACA,QAAM,aAAa,GAAG,WAAW,CAAC,WAAZ,EAAtB;AAEA,QAAM,SAAS,GAAG,CAChB,KADgB,EAEhB,QAFgB,EAGhB,MAHgB,EAIhB,YAJgB,EAKhB,UALgB,EAMhB,WANgB,EAOhB,MAPgB,EAQhB,WARgB,EAShB,YATgB,EAUhB,KAVgB,EAWhB,UAXgB,EAYhB,UAZgB,EAahB,UAbgB,EAchB,eAdgB,EAehB,eAfgB,EAgBhB,OAhBgB,EAiBhB,WAjBgB,EAkBhB,QAlBgB,EAmBhB,SAnBgB,EAoBhB,WApBgB,EAqBhB,QArBgB,EAsBhB,KAtBgB,EAuBhB,QAvBgB,EAwBhB,SAxBgB,EAyBhB,SAzBgB,EA0BhB,SA1BgB,EA2BhB,MA3BgB,EA4BhB,QA5BgB,EA6BhB,aA7BgB,EA8BhB,MA9BgB,EA+BhB,MA/BgB,CAAlB;;AAkCA,QAAI,SAAS,CAAC,OAAV,CAAkB,QAAlB,IAA8B,CAA9B,IAAmC,UAAU,CAAC,KAAD,CAAjD,EAA0D;AACxD,MAAA,MAAM,CAAC,aAAD,CAAN,GAAwB,IAAxB;AACD,KAFD,MAEO,IAAI,SAAS,CAAC,OAAV,CAAkB,QAAlB,KAA+B,CAAnC,EAAsC;AAC3C,UAAI,CAAC,MAAM,CAAC,MAAZ,EAAoB;AAClB,QAAA,MAAM,CAAC,MAAP,GAAgB,EAAhB;AACD;;AAED,MAAA,MAAM,CAAC,MAAP,CAAc,IAAd,CAAkB,QAAA,CAAA;AAChB,QAAA,SAAS,EAAE;AADK,OAAA,EAEb,KAFa,CAAlB;AAID,KATM,MASA,IAAI,aAAa,KAAK,MAAtB,EAA8B;AACnC,UAAI,CAAC,MAAM,CAAC,IAAZ,EAAkB;AAChB,QAAA,MAAM,CAAC,IAAP,GAAc,EAAd;AACD;;AACD,MAAA,MAAM,CAAC,IAAP,CAAY,IAAZ,CAAiB,KAAjB;AACD,KALM,MAKA,IAAI,aAAa,KAAK,QAAtB,EAAgC;AACrC,UAAI,CAAC,MAAM,CAAC,MAAZ,EAAoB;AAClB,QAAA,MAAM,CAAC,MAAP,GAAgB,EAAhB;AACD;;AACD,MAAA,MAAM,CAAC,MAAP,CAAc,IAAd,CAAmB,KAAnB;AACD,KALM,MAKA,IAAI,aAAa,KAAK,OAAtB,EAA+B;AACpC,UAAI,CAAC,MAAM,CAAC,KAAZ,EAAmB;AACjB,QAAA,MAAM,CAAC,KAAP,GAAe,EAAf;AACD;;AACD,MAAA,MAAM,CAAC,KAAP,CAAa,IAAb,CAAkB,KAAlB;AACD,KALM,MAKA,IAAI,aAAa,KAAK,QAAtB,EAAgC;AACrC,UAAI,CAAC,MAAM,CAAC,MAAZ,EAAoB;AAClB,QAAA,MAAM,CAAC,MAAP,GAAgB,EAAhB;AACD;;AACD,MAAA,MAAM,CAAC,MAAP,CAAc,IAAd,CAAmB,KAAnB;AACD,KALM,MAKA;AACL,MAAA,MAAM,CAAC,aAAD,CAAN,GAAwB,KAAxB;AACD;;AAED,WAAO,MAAP;AACD,GA1EM;;AA2HA,EAAA,KAAA,CAAA,SAAA,CAAA,gBAAA,GAAP,YAAA;AACE,QAAM,KAAK,GAAG,KAAK,KAAnB;AACA,QAAM,UAAU,GAAG,KAAK,UAAxB;AACA,QAAM,MAAM,GAAG,KAAK,MAApB;;AAEA,QAAI,CAAC,UAAU,CAAC,KAAD,CAAf,EAAwB;AACtB,MAAA,MAAM,CAAC,KAAP,GAAe,EAAf;;AAEA,WAAK,IAAM,IAAX,IAAmB,KAAnB,EAA0B;AACxB,YAAI,KAAK,CAAC,cAAN,CAAqB,IAArB,CAAJ,EAAgC;AAC9B,UAAA,MAAM,CAAC,KAAP,CAAa,IAAb,CAAkB,KAAK,CAAC,IAAD,CAAvB;AACD;AACF;AACF;;AAED,QAAI,CAAC,UAAU,CAAC,UAAD,CAAf,EAA6B;AAC3B,MAAA,MAAM,CAAC,KAAP,CAAa,KAAb,GAAqB,EAArB;;AAEA,WAAK,IAAM,IAAX,IAAmB,UAAnB,EAA+B;AAC7B,YAAI,UAAU,CAAC,cAAX,CAA0B,IAA1B,CAAJ,EAAqC;AACnC,UAAA,MAAM,CAAC,KAAP,CAAa,KAAb,CAAmB,IAAnB,CAAwB,UAAU,CAAC,IAAD,CAAlC;AACD;AACF;AACF;AACF,GAxBM;;AA0BA,EAAA,KAAA,CAAA,SAAA,CAAA,mBAAA,GAAP,UAA2B,MAA3B,EAAsC;AACpC,QAAI,KAAK,KAAT,EAAgB;AACd,WAAK,KAAL,CAAW,OAAX;AACD;;AAED,SAAK,kBAAL,CAAwB,KAAK,KAA7B,EAAoC,KAAK,MAAzC;AACA,SAAK,iBAAL,CAAuB,KAAK,KAA5B,EAAmC,KAAK,MAAxC;AAEA,IAAA,MAAM,CAAC,KAAP,CAAa,SAAb,GAAyB,KAAK,SAA9B;AAEA,SAAK,gBAAL;AACA,SAAK,KAAL,GAAa,KAAK,CAAC,MAAD,CAAlB;AACD,GAZM;;AAcA,EAAA,KAAA,CAAA,SAAA,CAAA,oBAAA,GAAP,UAA4B,MAA5B,EAAuC;AACrC,SAAK,kBAAL,CAAwB,KAAK,KAA7B,EAAoC,KAAK,MAAzC;AACA,SAAK,iBAAL,CAAuB,KAAK,KAA5B,EAAmC,KAAK,MAAxC;AAEA,SAAK,gBAAL;;AACA,QAAI,KAAK,KAAT,EAAgB;AACd,WAAK,KAAL,CAAW,OAAX,CAAmB,MAAnB;AACD,KAFD,MAEO;AACL,MAAA,MAAM,CAAC,KAAP,CAAa,SAAb,GAAyB,KAAK,SAA9B;AACA,WAAK,KAAL,GAAa,KAAK,CAAC,MAAD,CAAlB;AACD;AACF,GAXM;;AAaA,EAAA,KAAA,CAAA,SAAA,CAAA,eAAA,GAAP,YAAA;AACE,SAAK,MAAL,GAAc,EAAd;AACA,SAAK,KAAL,GAAa,EAAb;AACD,GAHM;;AAKA,EAAA,KAAA,CAAA,SAAA,CAAA,iBAAA,GAAP,YAAA;AACE,SAAK,mBAAL,CAAyB,KAAK,MAA9B;AACA,SAAK,eAAL;AACD,GAHM;;AAKA,EAAA,KAAA,CAAA,SAAA,CAAA,kBAAA,GAAP,UAA0B,KAA1B,EAAwC;AACtC,SAAK,oBAAL,CAA0B,KAAK,MAA/B;AACA,SAAK,eAAL;AACD,GAHM;;AAKA,EAAA,KAAA,CAAA,SAAA,CAAA,oBAAA,GAAP,YAAA;AACE,QAAI,KAAK,KAAT,EAAgB;AACd,WAAK,KAAL,CAAW,OAAX;AACA,WAAK,KAAL,GAAa,IAAb;AACD;;AACD,SAAK,SAAL,GAAiB,IAAjB;AACD,GANM;;AAcA,EAAA,KAAA,CAAA,SAAA,CAAA,MAAA,GAAP,YAAA;AACE,WAAO,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA;AAAK,MAAA,GAAG,EAAE,KAAK;AAAf,KAAA,EAA2B,KAAK,KAAL,CAAW,QAAtC,CAAP;AACD,GAFM;;AA1QO,EAAA,KAAA,CAAA,iBAAA,GAAoB;AAChC,IAAA,kBAAkB,EAAE,SAAS,CAAC,IADE;AAEhC,IAAA,UAAU,EAAE,SAAS,CAAC,IAFU;AAGhC,IAAA,QAAQ,EAAE,SAAS,CAAC;AAHY,GAApB;AA6QhB,SAAA,KAAA;AAAC,CA9QD,CAAmC,KAAK,CAAC,SAAzC,CAAA;;eAAqB,K","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport viser from 'viser';\nfunction firstLowerCase(str) {\n    return str.replace(/^\\S/, function (s) {\n        return s.toLowerCase();\n    });\n}\nfunction retain(obj, attr) {\n    var newObj = Object.create(null);\n    for (var item in obj) {\n        if (obj.hasOwnProperty(item)) {\n            var arrAttr = Array.isArray(attr) ? attr : [attr];\n            if (arrAttr.indexOf(item) >= 0) {\n                newObj[item] = obj[item];\n            }\n        }\n    }\n    return newObj;\n}\nfunction omit(obj, attr) {\n    var newObj = Object.create(null);\n    for (var item in obj) {\n        if (obj.hasOwnProperty(item)) {\n            var arrAttr = Array.isArray(attr) ? attr : [attr];\n            if (arrAttr.indexOf(item) < 0) {\n                newObj[item] = obj[item];\n            }\n        }\n    }\n    return newObj;\n}\nfunction isOwnEmpty(obj) {\n    for (var name_1 in obj) {\n        if (obj.hasOwnProperty(name_1)) {\n            return false;\n        }\n    }\n    return true;\n}\nvar Chart = (function (_super) {\n    __extends(Chart, _super);\n    function Chart(props) {\n        var _this = _super.call(this, props) || this;\n        _this.config = {};\n        _this.views = {};\n        _this.facetviews = {};\n        _this.centralizedUpdates = function (unit) {\n            var config = _this.config;\n            var props = unit.props;\n            var displayName = unit.displayName;\n            var hasInViews = unit.context.hasInViews;\n            if (displayName === 'Facet') {\n                var options = omit(props, 'children');\n                config.facet = options;\n            }\n            else if (displayName === 'FacetView') {\n                var viewId = unit.state.viewId;\n                if (!_this.facetviews[viewId]) {\n                    _this.facetviews[viewId] = { viewId: viewId };\n                }\n                _this.combineViewConfig(props, _this.facetviews[viewId]);\n            }\n            else if (displayName === 'View') {\n                var viewId = unit.state.viewId;\n                if (!_this.views[viewId]) {\n                    _this.views[viewId] = { viewId: viewId };\n                }\n                _this.combineViewConfig(props, _this.views[viewId]);\n            }\n            else {\n                if (!hasInViews) {\n                    _this.combineContentConfig(displayName, props, config);\n                }\n                else {\n                    var viewType = unit.context.viewType;\n                    var viewId = unit.context.viewId;\n                    if (viewType === 'view') {\n                        if (!_this.views[viewId]) {\n                            _this.views[viewId] = { viewId: viewId };\n                        }\n                        _this.combineContentConfig(displayName, props, _this.views[viewId]);\n                    }\n                    else if (viewType === 'facet') {\n                        if (!_this.facetviews[viewId]) {\n                            _this.facetviews[viewId] = { viewId: viewId };\n                        }\n                        _this.combineContentConfig(displayName, props, _this.facetviews[viewId]);\n                    }\n                }\n            }\n        };\n        _this.portalRef = function (container) {\n            if (!_this.container) {\n                _this.container = container;\n            }\n        };\n        return _this;\n    }\n    Chart.prototype.getChildContext = function () {\n        return {\n            centralizedUpdates: this.centralizedUpdates,\n            hasInViews: false,\n            viewType: 'view'\n        };\n    };\n    Chart.prototype.combineChartConfig = function (props, config) {\n        var chartRetain = [\n            'height', 'width', 'animate', 'forceFit',\n            'background', 'plotBackground', 'padding', 'theme',\n            'renderer',\n            'onMouseDown', 'onMouseMove', 'onMouseUp',\n            'onClick', 'onDbClick',\n            'onTouchStart', 'onTouchMove', 'onTouchEnd',\n            'onPlotEnter', 'onPlotMove', 'onPlotLeave',\n            'onPlotClick', 'onPlotDbClick',\n        ];\n        config.chart = retain(props, chartRetain);\n    };\n    Chart.prototype.combineViewConfig = function (props, config) {\n        if (props.data) {\n            config.data = props.data;\n        }\n        if (props.scale) {\n            config.scale = props.scale;\n        }\n        if (props.filter) {\n            config.filter = props.filter;\n        }\n        if (props.start) {\n            config.start = props.start;\n        }\n        if (props.end) {\n            config.end = props.end;\n        }\n    };\n    Chart.prototype.combineContentConfig = function (displayName, props, config) {\n        var realName = firstLowerCase(displayName);\n        var nameLowerCase = displayName.toLowerCase();\n        var regSeries = [\n            'pie',\n            'sector',\n            'line',\n            'smoothLine',\n            'dashLine',\n            'stackLine',\n            'area',\n            'stackArea',\n            'smoothArea',\n            'bar',\n            'stackBar',\n            'dodgeBar',\n            'interval',\n            'stackInterval',\n            'dodgeInterval',\n            'point',\n            'waterfall',\n            'funnel',\n            'pyramid',\n            'radialBar',\n            'schema',\n            'box',\n            'candle',\n            'polygon',\n            'contour',\n            'heatmap',\n            'edge',\n            'sankey',\n            'jitterPoint',\n            'path',\n            'venn',\n        ];\n        if (regSeries.indexOf(realName) < 0 && isOwnEmpty(props)) {\n            config[nameLowerCase] = true;\n        }\n        else if (regSeries.indexOf(realName) >= 0) {\n            if (!config.series) {\n                config.series = [];\n            }\n            config.series.push(__assign({ quickType: realName }, props));\n        }\n        else if (nameLowerCase === 'axis') {\n            if (!config.axis) {\n                config.axis = [];\n            }\n            config.axis.push(props);\n        }\n        else if (nameLowerCase === 'series') {\n            if (!config.series) {\n                config.series = [];\n            }\n            config.series.push(props);\n        }\n        else if (nameLowerCase === 'guide') {\n            if (!config.guide) {\n                config.guide = [];\n            }\n            config.guide.push(props);\n        }\n        else if (nameLowerCase === 'legend') {\n            if (!config.legend) {\n                config.legend = [];\n            }\n            config.legend.push(props);\n        }\n        else {\n            config[nameLowerCase] = props;\n        }\n        return config;\n    };\n    Chart.prototype.changeViewConfig = function () {\n        var views = this.views;\n        var facetviews = this.facetviews;\n        var config = this.config;\n        if (!isOwnEmpty(views)) {\n            config.views = [];\n            for (var item in views) {\n                if (views.hasOwnProperty(item)) {\n                    config.views.push(views[item]);\n                }\n            }\n        }\n        if (!isOwnEmpty(facetviews)) {\n            config.facet.views = [];\n            for (var item in facetviews) {\n                if (facetviews.hasOwnProperty(item)) {\n                    config.facet.views.push(facetviews[item]);\n                }\n            }\n        }\n    };\n    Chart.prototype.createChartInstance = function (config) {\n        if (this.chart) {\n            this.chart.destroy();\n        }\n        this.combineChartConfig(this.props, this.config);\n        this.combineViewConfig(this.props, this.config);\n        config.chart.container = this.container;\n        this.changeViewConfig();\n        this.chart = viser(config);\n    };\n    Chart.prototype.repaintChartInstance = function (config) {\n        this.combineChartConfig(this.props, this.config);\n        this.combineViewConfig(this.props, this.config);\n        this.changeViewConfig();\n        if (this.chart) {\n            this.chart.repaint(config);\n        }\n        else {\n            config.chart.container = this.container;\n            this.chart = viser(config);\n        }\n    };\n    Chart.prototype.clearConfigData = function () {\n        this.config = {};\n        this.views = {};\n    };\n    Chart.prototype.componentDidMount = function () {\n        this.createChartInstance(this.config);\n        this.clearConfigData();\n    };\n    Chart.prototype.componentDidUpdate = function (props) {\n        this.repaintChartInstance(this.config);\n        this.clearConfigData();\n    };\n    Chart.prototype.componentWillUnmount = function () {\n        if (this.chart) {\n            this.chart.destroy();\n            this.chart = null;\n        }\n        this.container = null;\n    };\n    Chart.prototype.render = function () {\n        return React.createElement(\"div\", { ref: this.portalRef }, this.props.children);\n    };\n    Chart.childContextTypes = {\n        centralizedUpdates: PropTypes.func,\n        hasInViews: PropTypes.bool,\n        viewType: PropTypes.string\n    };\n    return Chart;\n}(React.Component));\nexport default Chart;\n//# sourceMappingURL=Chart.js.map"]},"metadata":{},"sourceType":"module"}